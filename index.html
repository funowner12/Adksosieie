<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fun Admin Panel — Improved UI</title>

<!-- Firebase (compat) -->
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>

<style>
  :root{
    --bg-1:#061021; --bg-2:#081526;
    --card:#0f1720; --muted:#9fb3c6; --accent:#00e0ff; --green:#00ff9a; --danger:#ff6b6b;
    --glass: rgba(255,255,255,0.03);
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));color:#e6f7ff;-webkit-font-smoothing:antialiased}
  .wrap{max-width:740px;margin:18px auto;padding:16px}

  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:16px;box-shadow:0 18px 60px rgba(1,6,18,0.6);backdrop-filter:blur(6px)}
  header{display:flex;gap:12px;align-items:center}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--green));display:flex;align-items:center;justify-content:center;font-weight:900;color:#042}
  h1{margin:0;font-size:18px;color:var(--accent)}
  p.desc{margin:2px 0 0 0;color:var(--muted);font-size:13px}

  .status{margin-top:12px;padding:10px;border-radius:12px;background:var(--glass);display:flex;align-items:center;gap:10px}
  .dot{width:11px;height:11px;border-radius:50%;background:#ffd95a;box-shadow:0 6px 20px rgba(255,200,80,0.06)}

  form.controls{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:14px}
  input,select{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;font-size:15px}
  input[readonly]{opacity:0.85}

  .btn-row{display:flex;gap:10px;margin-top:8px}
  button{cursor:pointer;border-radius:12px;border:none;padding:10px 12px;font-weight:800}
  .btn-primary{background:linear-gradient(90deg,var(--accent),var(--green));color:#012}
  .btn-muted{background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted)}
  .btn-danger{background:linear-gradient(90deg,#ff9b9b,#ff6b6b);color:white}

  hr.sep{border:none;height:1px;background:linear-gradient(90deg, transparent, rgba(255,255,255,0.03), transparent);margin:18px 0;border-radius:4px}

  /* user list */
  .list-head{display:flex;align-items:center;justify-content:space-between;margin-top:6px}
  .user-count{color:var(--muted);font-weight:700}

  .searchRow{display:flex;gap:8px;margin-top:10px}
  .searchRow input{flex:1;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}

  .list{display:grid;gap:12px;margin-top:12px}
  .row{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));box-shadow:0 8px 28px rgba(0,0,0,0.45)}
  .left{display:flex;align-items:center;gap:12px}
  .badge{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:900;color:#012;font-size:18px}
  .info{display:flex;flex-direction:column}
  .mobile{font-size:16px;font-weight:900;color:#e6fbff}
  .meta{font-size:12px;color:var(--muted);margin-top:4px}

  .right{display:flex;align-items:center;gap:10px}
  .time-pill{padding:6px 10px;border-radius:10px;background:rgba(255,255,255,0.03);font-weight:700;font-size:12px;color:var(--muted)}
  .del-btn{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--danger);font-weight:800}

  /* FAB */
  .fab{position:fixed;right:20px;bottom:20px;width:62px;height:62px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent),var(--green));color:#002;font-weight:900;font-size:28px;box-shadow:0 18px 40px rgba(0,212,255,0.12);border:4px solid rgba(255,255,255,0.04)}

  @media(max-width:640px){ .badge{width:48px;height:48px;font-size:16px} .mobile{font-size:15px} .row{padding:10px} .right{gap:8px} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="logo">FAN</div>
        <div>
          <h1>Fun Admin Panel</h1>
          <p class="desc">Made By @FUN_786</p>
        </div>
      </header>

      <div class="status" style="margin-top:12px">
        <div class="dot"></div>
        <div style="margin-left:8px;color:var(--muted)">Connected</div>
      </div>

      <form class="controls" onsubmit="event.preventDefault()">
        <input id="title" class="full" placeholder="Community / Title name">
        <input id="injector" placeholder="Injector name">
      </form>

      <div class="btn-row">
        <button type="button" class="btn-primary" onclick="saveSettings()">Save</button>
        <button type="button" class="btn-muted" onclick="resetSettings()">Reset</button>
      </div>

      <hr class="sep">

      <h3 style="margin:0;color:var(--accent)">Add User</h3>
      <div style="display:grid;grid-template-columns:1fr 120px;gap:10px;margin-top:10px">
        <input id="mobile" placeholder="Enter full mobile number" inputmode="numeric">
        <input id="time" readonly placeholder="Time (auto)">
      </div>

      <div style="display:grid;grid-template-columns:1fr 120px;gap:10px;margin-top:10px">
        <select id="brand">
          <option value="">-- Choose Brand --</option>
          <option>Owner</option><option>Samsung</option><option>Xiaomi</option><option>Realme</option><option>Oppo</option><option>Vivo</option><option>OnePlus</option><option>Other</option>
        </select>
        <div style="display:flex;gap:8px">
          <button type="button" class="btn-primary" style="flex:1" onclick="addUser()">Add</button>
          <button type="button" class="btn-muted" style="width:90px" onclick="clearForm()">Clear</button>
        </div>
      </div>

      <div class="list-head">
        <div style="margin-top:14px"><strong style="color:var(--accent)">Users</strong> <span id="count" class="user-count">(0)</span></div>
        <div style="margin-top:14px" class="searchRow">
          <input id="search" placeholder="Search number/brand" />
          <button type="button" class="btn-muted" onclick="clearSearch()">Clear</button>
        </div>
      </div>

      <div id="list" class="list" aria-live="polite" style="margin-top:10px">
        <div style="padding:22px;color:var(--muted);text-align:center">Loading...</div>
      </div>
    </div>
  </div>

  <div class="fab" onclick="document.getElementById('mobile').focus()">+</div>

<script>
  // --- firebase config (keep your keys) ---
  const firebaseConfig = {
    apiKey: "AIzaSyD1k-DTIpfS8VYMGx-NMc1dpOYIZAQQjds",
    authDomain: "ytfuneduction.firebaseapp.com",
    databaseURL: "https://ytfuneduction-default-rtdb.firebaseio.com",
    projectId: "ytfuneduction",
    storageBucket: "ytfuneduction.firebasestorage.app",
    messagingSenderId: "681748387728",
    appId: "1:681748387728:web:abc123"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const UsersRef = db.ref("Users");
  const dataRef = db.ref("data/data");

  // helpers
  const esc = s => String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');

  // auto time (short)
  function setTime() {
    document.getElementById('time').value = new Date().toLocaleString('en-IN');
  }
  setTime(); setInterval(setTime,1000);

  // load settings
  dataRef.on('value', snap => {
    const v = snap.val() || {};
    document.getElementById('title').value = v.title || '';
    document.getElementById('injector').value = v.Injectorname || '';
  });

  function saveSettings() {
    const t = document.getElementById('title').value.trim();
    const i = document.getElementById('injector').value.trim();
    const up = {};
    if (t) up.title = t;
    if (i) up.Injectorname = i;
    if (Object.keys(up).length) {
      dataRef.update(up).then(()=> showToast('Settings saved')).catch(e => showToast('Error: ' + (e.message||e)));
    } else showToast('Nothing to save');
  }
  function resetSettings(){ document.getElementById('title').value=''; document.getElementById('injector').value=''; showToast('Reset'); }

  // add user (mobile used as key)
  function addUser(){
    const mobile = document.getElementById('mobile').value.trim();
    const brand  = document.getElementById('brand').value;
    if (!mobile || !brand) { alert('Please enter number and brand'); return; }
    const payload = { mobile, brand, time: new Date().toLocaleString('en-IN') };
    UsersRef.child(mobile).set(payload).then(()=> {
      showToast('User added');
      clearForm();
    }).catch(e => showToast('Error: ' + (e.message||e)));
  }
  function clearForm(){ document.getElementById('mobile').value=''; document.getElementById('brand').value=''; setTime(); }

  // live items cache (for search)
  let items = [];

  // load users snapshot -> stable array -> newest first -> render
  UsersRef.on('value', snap => {
    items = [];
    const list = document.getElementById('list');
    const countEl = document.getElementById('count');
    list.innerHTML = '';
    if (!snap.exists()) {
      list.innerHTML = '<div style="padding:22px;color:var(--muted);text-align:center">No users yet</div>';
      if (countEl) countEl.textContent = '(0)';
      return;
    }

    snap.forEach(ch => {
      const u = ch.val() || {};
      const key = ch.key;
      let timeVal = 0;
      try {
        timeVal = u.time ? new Date(u.time).getTime() : 0;
        if (Number.isNaN(timeVal)) timeVal = 0;
      } catch(e){ timeVal = 0; }
      items.push({ key, data: u, timeVal });
    });

    // newest first
    items.sort((a,b) => b.timeVal - a.timeVal);
    if (countEl) countEl.textContent = '(' + items.length + ')';
    render(items);
  });

  function render(listArr) {
    const container = document.getElementById('list');
    container.innerHTML = '';
    const frag = document.createDocumentFragment();
    for (let i=0;i<listArr.length;i++){
      const idx = i+1;
      const item = listArr[i];
      const row = document.createElement('div');
      row.className = 'row';
      // short time (show only time), full datetime in title
      let displayTime = '--';
      let fullTime = '';
      if (item.data && item.data.time) {
        fullTime = item.data.time;
        try {
          const dt = new Date(fullTime);
          if (!Number.isNaN(dt.getTime())) displayTime = dt.toLocaleTimeString('en-IN');
          else displayTime = fullTime;
        } catch(e) { displayTime = fullTime; }
      }
      // badge gradient choices
      const grads = [
        'linear-gradient(135deg,#ffdede,#ffd0ff)',
        'linear-gradient(135deg,#d0f8ff,#c8ffd8)',
        'linear-gradient(135deg,#fff4d6,#ffd7a6)'
      ];
      const g = grads[idx % grads.length];

      row.innerHTML = `
        <div class="left">
          <div class="badge" style="background:${g}">${idx}</div>
          <div class="info">
            <div class="mobile">${esc(item.data.mobile || '')}</div>
            <div class="meta">${esc(item.data.brand || '')}</div>
          </div>
        </div>
        <div class="right">
          <div class="time-pill" title="${esc(fullTime)}">${esc(displayTime)}</div>
          <button type="button" class="del-btn" data-key="${esc(item.key)}">Delete</button>
        </div>
      `;

      // attach delete handler (no confirm — direct remove for WebView compatibility)
      const delBtn = row.querySelector('.del-btn');
      if (delBtn) {
        delBtn.addEventListener('click', () => {
          // directly remove (confirm() may not work in Android WebView without WebChromeClient)
          const key = delBtn.getAttribute('data-key');
          if (!key) { showToast('Key missing'); return; }
          UsersRef.child(key).remove()
            .then(()=> showToast('Deleted'))
            .catch(e => showToast('Delete error: ' + (e.message||e)));
        });
      }

      frag.appendChild(row);
    }
    container.appendChild(frag);
  }

  // search
  document.getElementById('search').addEventListener('input', e=>{
    const q = String(e.target.value||'').trim().toLowerCase();
    if (!q) return render(items);
    const filtered = items.filter(it => {
      const m = String(it.data.mobile||'').toLowerCase();
      const b = String(it.data.brand||'').toLowerCase();
      return m.includes(q) || b.includes(q);
    });
    render(filtered);
  });
  function clearSearch(){ document.getElementById('search').value=''; render(items); }

  // small toast
  function showToast(msg, ms=1500){
    const t = document.createElement('div');
    t.textContent = msg;
    t.style.position = 'fixed';
    t.style.left = '50%';
    t.style.transform = 'translateX(-50%)';
    t.style.bottom = '86px';
    t.style.background = 'rgba(0,0,0,0.6)';
    t.style.color = '#fff';
    t.style.padding = '10px 14px';
    t.style.borderRadius = '10px';
    t.style.zIndex = 9999;
    document.body.appendChild(t);
    setTimeout(()=> t.remove(), ms);
  }

  // keyboard enter -> add
  document.getElementById('mobile').addEventListener('keydown', e => {
    if (e.key === 'Enter') { e.preventDefault(); addUser(); }
  });
</script>
</body>
</html>
